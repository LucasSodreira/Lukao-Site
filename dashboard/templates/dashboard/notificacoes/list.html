{% extends 'dashboard/base.html' %}

{% block content %}
<div class="container-fluid p-4">
    <h1>Notificações</h1>

    <!-- Mensagens -->
    {% if messages %}
        <div class="mb-4">
            {% for message in messages %}
                <div class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Ações -->
    <div class="mb-4">
        <form method="post">
            {% csrf_token %}
            <button type="submit" name="mark_all_read" class="btn btn-primary"><i class="fas fa-check"></i> Marcar todas como lidas</button>
        </form>
    </div>

    <!-- Tabela de Notificações -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Mensagem</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for notificacao in notificacoes %}
                            <tr {% if notificacao.unread %}class="table-warning"{% endif %}>
                                <td>{{ notificacao.timestamp|date:"d/m/Y H:i" }}</td>
                                <td>{{ notificacao.description }}</td>
                                <td>{{ notificacao.unread|yesno:"Não lida,Lida" }}</td>
                                <td>
                                    {% if notificacao.target %}
                                        <a href="{% url 'dashboard:pedido_detail' notificacao.target.id %}" class="btn btn-sm btn-primary"><i class="fas fa-eye"></i> Ver Pedido</a>
                                    {% endif %}
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" class="text-center">Nenhuma notificação encontrada.</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}